spring:
  application:
    name: viridial-organization
  
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  
  # DataSource Configuration
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/viridialdb}
    username: ${DATABASE_USERNAME:postgres}
    password: ${DATABASE_PASSWORD:123456}
    driver-class-name: org.postgresql.Driver
    
    # HikariCP Connection Pool Configuration
    hikari:
      maximum-pool-size: ${HIKARI_MAX_POOL_SIZE:20}
      minimum-idle: ${HIKARI_MIN_IDLE:5}
      idle-timeout: ${HIKARI_IDLE_TIMEOUT:300000} # 5 minutes
      max-lifetime: ${HIKARI_MAX_LIFETIME:1800000} # 30 minutes
      connection-timeout: ${HIKARI_CONNECTION_TIMEOUT:30000} # 30 seconds
      validation-timeout: ${HIKARI_VALIDATION_TIMEOUT:5000} # 5 seconds
      validation-query: SELECT 1
      pool-name: viridial-organization-pool
      leak-detection-threshold: ${HIKARI_LEAK_DETECTION:60000} # 1 minute
      register-mbeans: true
      auto-commit: false # Disable auto-commit to allow Spring transaction management
  
  # JPA/Hibernate Configuration
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: ${JPA_DDL_AUTO:update} # validate, update, create, create-drop, none
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyLegacyJpaImpl
    show-sql: ${JPA_SHOW_SQL:false}
    properties:
      hibernate:
        format_sql: ${JPA_FORMAT_SQL:true}
        use_sql_comments: ${JPA_USE_SQL_COMMENTS:true}
        jdbc:
          batch_size: ${JPA_BATCH_SIZE:20}
          order_inserts: true
          order_updates: true
        connection:
          provider_disables_autocommit: true
        generate_statistics: ${JPA_GENERATE_STATISTICS:false}
        cache:
          use_second_level_cache: false
          use_query_cache: false
  
  # Validation Configuration
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
  
  # Jackson Configuration
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: ${JACKSON_INDENT_OUTPUT:false}
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null
  
  # Web Configuration
  web:
    resources:
      add-mappings: true

# Server Configuration
server:
  port: ${SERVER_PORT:8081}
  servlet:
    context-path: ${SERVER_CONTEXT_PATH:/}
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain,application/javascript,text/css
    min-response-size: 1024
  error:
    include-message: always
    include-binding-errors: always
    include-stacktrace: ${SERVER_ERROR_STACKTRACE:never} # on_param, always, never
    include-exception: false

# Logging Configuration
logging:
  level:
    root: ${LOG_LEVEL_ROOT:INFO}
    # Application packages
    com.viridial: ${LOG_LEVEL_VIRIDIAL:DEBUG}
    com.viridial.referentiel: ${LOG_LEVEL_REFERENTIEL:DEBUG}
    com.viridial.organization: ${LOG_LEVEL_ORGANIZATION:DEBUG}
    com.viridial.countries: ${LOG_LEVEL_COUNTRIES:DEBUG}
    com.viridial.common: ${LOG_LEVEL_COMMON:DEBUG}
    # Spring Framework
    org.springframework: ${LOG_LEVEL_SPRING:INFO}
    org.springframework.web: ${LOG_LEVEL_WEB:INFO}
    org.springframework.security: ${LOG_LEVEL_SECURITY:DEBUG}
    org.springframework.transaction: ${LOG_LEVEL_TRANSACTION:DEBUG}
    org.springframework.data: ${LOG_LEVEL_DATA:DEBUG}
    org.springframework.data.jpa: ${LOG_LEVEL_DATA_JPA:DEBUG}
    org.springframework.boot: ${LOG_LEVEL_BOOT:INFO}
    org.springframework.context: ${LOG_LEVEL_CONTEXT:INFO}
    org.springframework.beans: ${LOG_LEVEL_BEANS:INFO}
    org.springframework.orm: ${LOG_LEVEL_ORM:DEBUG}
    # Hibernate/JPA
    org.hibernate: ${LOG_LEVEL_HIBERNATE:INFO}
    org.hibernate.SQL: ${LOG_LEVEL_SQL:DEBUG}
    org.hibernate.type.descriptor.sql.BasicBinder: ${LOG_LEVEL_SQL_PARAMS:TRACE}
    org.hibernate.stat: ${LOG_LEVEL_HIBERNATE_STAT:DEBUG}
    org.hibernate.engine.transaction: ${LOG_LEVEL_HIBERNATE_TX:DEBUG}
    org.hibernate.engine.jdbc: ${LOG_LEVEL_HIBERNATE_JDBC:DEBUG}
    # Database
    org.postgresql: ${LOG_LEVEL_POSTGRESQL:WARN}
    com.zaxxer.hikari: ${LOG_LEVEL_HIKARI:INFO}
    com.zaxxer.hikari.HikariConfig: ${LOG_LEVEL_HIKARI_CONFIG:DEBUG}
    com.zaxxer.hikari.pool: ${LOG_LEVEL_HIKARI_POOL:DEBUG}
    # Validation
    org.hibernate.validator: ${LOG_LEVEL_VALIDATOR:WARN}
    jakarta.validation: ${LOG_LEVEL_VALIDATION:WARN}
    # HTTP/Tomcat
    org.apache.coyote: ${LOG_LEVEL_COYOTE:INFO}
    org.apache.tomcat: ${LOG_LEVEL_TOMCAT:INFO}
    org.apache.catalina: ${LOG_LEVEL_CATALINA:INFO}
    # Jackson
    com.fasterxml.jackson: ${LOG_LEVEL_JACKSON:WARN}
    # Other
    org.apache: ${LOG_LEVEL_APACHE:WARN}
    org.eclipse: ${LOG_LEVEL_ECLIPSE:WARN}
    org.reflections: ${LOG_LEVEL_REFLECTIONS:WARN}
  
  # Log Pattern Configuration
  pattern:
    # Enhanced console pattern with colors, thread, logger, and exception details
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"
    # Enhanced file pattern with full details including stack traces
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} %5p ${PID:- } --- [%t] %-40.40logger{39} : %m%n%wEx"
  
  # File Logging Configuration
  file:
    name: ${LOG_FILE:logs/viridial-organization.log}
    max-size: ${LOG_FILE_MAX_SIZE:50MB}
    max-history: ${LOG_FILE_MAX_HISTORY:30}
    total-size-cap: ${LOG_FILE_TOTAL_SIZE:1GB}
    clean-history-on-start: ${LOG_CLEAN_ON_START:false}
    # Error Log File (separate file for errors only)
    error:
      name: ${LOG_ERROR_FILE:logs/viridial-organization-error.log}
      max-size: ${LOG_ERROR_MAX_SIZE:50MB}
      max-history: ${LOG_ERROR_MAX_HISTORY:90}
  
  # Logback Configuration (see logback-spring.xml for advanced configuration)
  logback:
    rollingpolicy:
      file-name-pattern: ${LOG_FILE_PATTERN:logs/viridial-organization-%d{yyyy-MM-dd}-%i.log}
      max-file-size: ${LOG_FILE_MAX_SIZE:50MB}
      max-history: ${LOG_FILE_MAX_HISTORY:30}
      total-size-cap: ${LOG_FILE_TOTAL_SIZE:1GB}
      clean-history-on-start: ${LOG_CLEAN_ON_START:false}

# Management/Actuator Configuration (if actuator is added)
management:
  endpoints:
    web:
      exposure:
        include: ${ACTUATOR_ENDPOINTS:health,info}
      base-path: /actuator
  endpoint:
    health:
      show-details: ${ACTUATOR_HEALTH_DETAILS:when-authorized}
  info:
    env:
      enabled: true

# Application Custom Properties
app:
  name: Viridial Organization
  version: 0.0.1-SNAPSHOT
  description: Viridial Organization Management Service
